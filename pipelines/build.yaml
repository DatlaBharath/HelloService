{"pipeline":{"name":"build","identifier":"build","projectIdentifier":"default_project","orgIdentifier":"default","tags":{},"stages":[{"stage":{"name":"Build and Deploy","identifier":"Build_And_Deploy","type":"Custom","spec":{"execution":{"steps":[{"step":{"name":"Checkout Code","identifier":"Checkout_Code","type":"ShellScript","spec":{"shell":"Bash","source":{"type":"Inline","spec":{"script":"echo \"Cloning the  repo...\"\nrm -rf helloservice\ngit clone https://github.com/DatlaBharath/helloservice.git\ncd helloservice\npwd\nls\n"}},"executionTarget":{},"environmentVariables":[],"outputVariables":[]},"timeout":"10m"}},{"step":{"name":"Build Project","identifier":"Build_Project","type":"ShellScript","spec":{"shell":"Bash","onDelegate":true,"source":{"type":"Inline","spec":{"script":"cd helloservice\nmvn clean install -DskipTests\n"}}}}},{"step":{"name":"Build Docker Image","identifier":"Build_Image","type":"ShellScript","spec":{"shell":"Bash","onDelegate":true,"source":{"type":"Inline","spec":{"script":"cd helloservice\ndocker build -t sakthisiddu1/helloservice:<+pipeline.sequenceId> .\n"}}}}},{"step":{"name":"Push Docker Image","identifier":"Push_Image","type":"ShellScript","spec":{"shell":"Bash","onDelegate":true,"environmentVariables":[{"name":"DOCKERHUB_USERNAME","type":"String","value":"<+secrets.getValue(\"dockerhub-username\")>"},{"name":"DOCKERHUB_PASSWORD","type":"String","value":"<+secrets.getValue(\"dockerhub-password\")>"}],"source":{"type":"Inline","spec":{"script":"cd helloservice\necho \"\"\"$DOCKERHUB_USERNAME\"\"\"\necho \"\"\"$DOCKERHUB_PASSWORD\"\"\"\necho \"\"\"$DOCKERHUB_PASSWORD\"\"\" | docker login -u \"\"\"$DOCKERHUB_USERNAME\"\"\" --password-stdin\ndocker push $DOCKERHUB_USERNAME/helloservice:<+pipeline.sequenceId>\n"}}}}},{"step":{"name":"Deploy to Kubernetes via SSH","identifier":"Deploy_K8s","type":"ShellScript","spec":{"shell":"Bash","onDelegate":true,"source":{"type":"Inline","spec":{"script":"git clone https://github.com/DatlaBharath/helloservice.git\ncd helloservice\necho \"Deploying to Kubernetes via SSH...\"\n\nssh -o StrictHostKeyChecking=no -i /home/harness/.ssh/test.pem ubuntu@13.235.115.15 \"helm install my-hello ./helm/helloservice\"\n\nrm -rf helloservice\n"}}}}}]}}}}]}}